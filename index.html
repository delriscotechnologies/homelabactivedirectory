<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Active Directory Home Lab</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap">
  <style>
    body {
      background-color: #1a0000; /* dark red background */
      color: #ff4d4d; /* bright red text */
      font-family: 'Share Tech Mono', monospace;
      padding: 2rem;
      line-height: 1.9;
    }
    h1, h2 {
      color: #ff1a1a;
      text-shadow: 0 0 8px #ff4d4d;
    }
    .section {
      border-left: 4px solid #ff1a1a;
      margin: 3rem 0;
      padding: 2rem;
      background-color: rgba(255, 26, 26, 0.08);
      box-shadow: 0 0 25px #ff1a1a;
      border-radius: 12px;
    }
    pre {
      background: rgba(50,0,0,0.6);
      padding: 1.2rem;
      overflow-x: auto;
      color: #ff8080;
      border-left: 4px solid #ff1a1a;
      border-radius: 6px;
    }
    img {
      display: block;
      margin: 1.5rem auto;
      max-width: 90%;
      border: 2px solid #ff1a1a;
      border-radius: 8px;
      box-shadow: 0 0 15px #ff4d4d;
    }
    footer {
      margin-top: 5rem;
      font-size: 0.95rem;
      color: #ff9999;
      text-align: center;
    }
    a {
      color: #ffb3b3;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <h1>Active Directory Home Lab: Building a Splunk-Powered Detection Environment</h1>
  </header>

  <section class="section">
    <h2>Introduction</h2>
    <p>In the realm of cybersecurity, hands-on experience is far more impactful than theory alone. While books, tutorials, and videos provide foundational knowledge, they rarely replicate the complexity and interactivity of a real network environment. This project, the <strong>Active Directory Home Lab</strong>, was conceived to bridge that gap. Its goal was to construct a miniature yet realistic enterprise environment, where authentication, policy enforcement, logging, and attack simulation could be explored in a safe, controlled setting.</p>

    <p>What made this lab unique was the intent behind each component. Instead of following a rigid guide, I designed the network to emulate realistic behaviors and challenges found in small-to-medium enterprises. This includes:</p>
    <ul>
      <li>Active Directory configuration for identity and access management.</li>
      <li>Windows endpoints integrated into the domain, sending enriched telemetry.</li>
      <li>Centralized log collection via Splunk to practice monitoring, correlation, and alerting.</li>
      <li>Simulated attacks using Hydra to evaluate detection capabilities.</li>
    </ul>

    <p>Choosing Active Directory and Windows Server was deliberate. These systems dominate enterprise environments, yet I had never configured them personally. Setting up domain controllers, organizational units, user accounts, and group policies was both challenging and highly educational. It forced me to confront real-world scenarios, such as DNS resolution, authentication flows, and policy enforcement. For consistency, all machines used <strong>DNS 8.8.8.8</strong>, simplifying connectivity and ensuring reliable name resolution.</p>

    <p>Overall, this lab was a hands-on exploration of both red team and blue team concepts. It provided a safe environment to witness, in real time, how user actions, system events, and attacker attempts generate meaningful signals. By the end, I could not only observe these signals but also understand their context and implications—a critical step toward mastering detection engineering and cybersecurity operations.</p>

    <img src="ad.png" alt="Active Directory screenshot">
  </section>

  <section class="section">
    <h2>Lab Architecture Overview</h2>
    <p>This lab simulates a small enterprise environment, designed for both operational and educational purposes. The network architecture includes:</p>
    <ul>
      <li><strong>Splunk Server (Ubuntu 22.04, 192.168.64.10)</strong>: Central hub for log collection, analysis, and visualization. Chosen for robust Linux support and easy VM deployment. The server receives telemetry from endpoints and provides dashboards for real-time monitoring (<a href="https://docs.splunk.com">Splunk Docs</a>).</li>
      <li><strong>Active Directory Domain Controller (Windows Server, 192.168.64.7)</strong>: Manages users, groups, organizational units, and policies. Provides enterprise-like authentication, authorization, and auditing capabilities (<a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview">Microsoft AD Docs</a>).</li>
      <li><strong>Windows 10 Workstation (192.168.64.100)</strong>: Simulates a standard user endpoint. Runs Splunk Universal Forwarder and Sysmon to forward detailed event data to Splunk.</li>
      <li><strong>Kali Linux Attacker (192.168.64.250)</strong>: Dedicated offensive machine. Executes controlled brute-force attacks using Hydra to generate realistic adversary activity, helping to test detection rules and monitoring efficacy.</li>
    </ul>
    <p>This design allows testing the full lifecycle of network events, from normal operations to malicious activity, and provides a framework for observing attacker behavior in a controlled environment.</p>
  </section>

  <section class="section">
    <h2>Setting Up the Ubuntu/Splunk Server</h2>
    <p>Steps taken to set up the Splunk server included:</p>
    <ol>
      <li>Installed <strong>Ubuntu Server 22.04</strong> in a VM with sufficient CPU, memory, and disk to handle log ingestion and analysis.</li>
      <li>Configured a static IP <strong>192.168.64.10</strong> to ensure reliable connectivity with all forwarders.</li>
      <li>Enabled shared folders for transferring the Splunk installation package from the host system.</li>
      <li>Installed Splunk using the .deb package:
        <pre>sudo dpkg -i splunk-package.deb</pre>
      </li>
      <li>Started Splunk, enabled it to launch on boot, and verified GUI access at <a href="http://192.168.64.10:8000">http://192.168.64.10:8000</a>.</li>
      <li>Port 9997 was ready to receive forwarded logs; no additional firewall or network configuration was required.</li>
    </ol>
    <p>References:</p>
    <ul>
      <li><a href="https://docs.splunk.com/Documentation/Splunk/latest/Install/InstallonLinux">Splunk Installation Docs</a></li>
      <li><a href="https://ubuntu.com/server/docs">Ubuntu Server Docs</a></li>
    </ul>

    <img src="ubuntu.png" alt="Ubuntu Server screenshot">
  </section>

  <section class="section">
    <h2>Active Directory Domain Controller Configuration</h2>
    <p>Setting up the Windows Server as a domain controller involved:</p>
    <ol>
      <li>Assigned static IP <strong>192.168.64.7</strong> and configured DNS to 8.8.8.8.</li>
      <li>Installed Active Directory Domain Services (AD DS) and promoted the server to host the forest <strong>delriscotechnologies.local</strong>.</li>
      <li>Created test user accounts for realistic simulations:
        <ul>
          <li><strong>Cris From Darisk</strong> – <code>CFDR</code></li>
          <li>Terry Smith – <code>TS</code></li>
        </ul>
      </li>
      <li>Created Organizational Units (OUs) for IT and HR to replicate enterprise groupings.</li>
      <li>Applied group policies to enforce password complexity, login restrictions, and auditing.</li>
      <li>Tested domain and DNS resolution, ensuring all machines could communicate reliably.</li>
    </ol>
    <p>References:</p>
    <ul>
      <li><a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview">Microsoft AD DS Docs</a></li>
    </ul>
  </section>

  <section class="section">
    <h2>Windows 10 Workstation Configuration</h2>
    <p>The workstation was configured to simulate a standard endpoint within the enterprise:</p>
    <ol>
      <li>Assigned static IP <strong>192.168.64.100</strong> and DNS 8.8.8.8 for consistent connectivity.</li>
      <li>Installed <strong>Splunk Universal Forwarder</strong> to ship Windows Event Logs to the Splunk server.</li>
      <li>Installed Sysmon to enrich telemetry, capturing process creation, network connections, and authentication events.</li>
      <li>Verified successful log ingestion in Splunk and confirmed event correlation with Active Directory events.</li>
    </ol>

    <img src="win10.png" alt="Windows 10 Workstation screenshot">
  </section>

  <section class="section">
    <h2>Sysmon Installation and Modular Configuration</h2>
    <p>Sysmon enhances Windows Event Logs by providing detailed, structured, and actionable telemetry:</p>
    <ol>
      <li>Downloaded Sysmon from Microsoft Sysinternals (<a href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon">Sysmon Docs</a>).</li>
      <li>Obtained Olaf Hartong’s Modular Sysmon configuration for filtered and meaningful events (<a href="https://github.com/olafhartong/sysmon-modular">Sysmon Modular</a>).</li>
      <li>Installed Sysmon using:
        <pre>.\sysmon64.exe -i ..\sysmonconfig.xml</pre>
      </li>
      <li>Ensured Sysmon ran under the user context to capture detailed per-user activity.</li>
      <li>Verified log forwarding to Splunk, enabling correlation with domain controller and endpoint activity.</li>
    </ol>

    <img src="splunkcito.png" alt="Splunk monitoring Sysmon events screenshot">
  </section>

  <section class="section">
    <h2>Simulating Attacks Using Hydra</h2>
    <p>Controlled simulations of attacks provide insight into attacker behavior:</p>
    <ol>
      <li>Configured Kali Linux (192.168.64.250) as the attack machine.</li>
      <li>Built a custom password list using entries from <code>rockyou.txt</code> and the actual CFDR password:
        <pre>cat rockyou.txt | grep -i "cfdr" > passwords.txt</pre>
      </li>
      <li>Executed Hydra against RDP on the Windows 10 workstation:
        <pre>hydra -t 1 -V -f -l CFDR -P passwords.txt rdp://192.168.64.100</pre>
      </li>
      <li>Monitored all authentication attempts, process creation, and network activity via Sysmon and Splunk.</li>
      <li>Analyzed patterns of attacks and timing to understand how brute-force techniques operate in real environments.</li>
    </ol>
    <p>References:</p>
    <ul>
      <li><a href="https://www.kali.org/tools/hydra/">Hydra Tool Docs</a></li>
      <li><a href="https://www.offensive-security.com/kali-linux-nethunter-tools/">Kali Linux Offensive Tools</a></li>
    </ul>

    <img src="kali.png" alt="Kali Linux screenshot">
  </section>

  <section class="section">
    <h2>Analyzing Data in Splunk</h2>
    <p>With all telemetry centralized in Splunk, analysis became the core activity:</p>
    <p>1. Search and correlate Windows Event Logs from AD and the workstation to identify anomalous login attempts:</p>
    <pre>index=wineventlog EventCode=4625 | stats count by Account_Name, src_ip</pre>
    <p>2. Visualize process creation, authentication events, and network connections:</p>
    <pre>index=sysmon EventCode=1 | stats count by Image, User, Computer</pre>
    <p>3. Separate logs into indexes for endpoints, servers, and attack telemetry for clarity:</p>
    <pre>index=endpoints, index=servers, index=attacks</pre>
    <p>4. Build dashboards and alerts for abnormal behavior, including repeated failed logins, lateral movement, and suspicious process execution.</p>
    <p>References:</p>
    <ul>
      <li><a href="https://docs.splunk.com/Documentation/Splunk/latest/SearchTutorial/WelcometotheSearchTutorial">Splunk Search Tutorial</a></li>
    </ul>

    <img src="splunk.png" alt="Splunk dashboard screenshot">
  </section>

<section class="section">
  <h2>Lessons Learned & Insights</h2>
  <p>Working through this lab was my first real experience with Active Directory, and honestly, it was both exciting and a little intimidating. Setting up Windows Server, promoting it to a domain controller, and creating users and organizational units made me truly appreciate the complexity behind enterprise environments. Applying Group Policies, configuring password rules, login restrictions, and auditing for the first time gave me a hands-on understanding of how administrators enforce security in a real network. At first, installing Sysmon and forwarding logs to Splunk felt overwhelming, but seeing the detailed telemetry and event correlations made me realize how important this data is for detecting suspicious activity like lateral movement or process injection. Simulating attacks with Hydra on Kali Linux was nerve-wracking yet enlightening, showing me how attackers exploit weak credentials and how defenders can spot these behaviors in real time. Centralizing all logs in Splunk helped me understand the value of dashboards, searches, and alerts in monitoring a network effectively. There were frustrating moments when things didn’t work, but troubleshooting, documenting commands, and referencing official guides taught me patience and problem-solving. By the end, I felt I could see the environment from both the attacker’s and defender’s perspectives, giving me a much deeper understanding of cybersecurity operations and the confidence to tackle more complex setups in the future.</p>
  <ul>
    <li>Hands-on experience with Active Directory made me understand authentication flows and policy enforcement for the first time.</li>
    <li>Seeing Sysmon and Splunk working together showed me the power of enriched telemetry for detection.</li>
    <li>Simulating attacks gave me perspective on how attackers think and how defenders must respond.</li>
    <li>Documenting steps and troubleshooting helped me develop patience and better technical habits.</li>
  </ul>
</section>

  <footer>
    <p>© 2025 Del Risco Technologies</p>
  </footer>
</body>
</html>
